<p-toast></p-toast>
<p-confirmdialog></p-confirmdialog>

<div class="page-container">
  <div class="header">
    <h1><i class="bi bi-list"></i> Vaše knihy</h1>
    <p-divider></p-divider>
  </div>

  @if (books.length > 0) {
    <div class="books-grid">
      @for (book of books; track book.id) {
        <p-card 
          class="book-card"
          [header]="book.name">
          
          <ng-template pTemplate="header">
            <div class="book-cover">
              <i class="bi bi-book book-icon"></i>
            </div>
          </ng-template>

          <div class="book-content">
            <h3>{{ book.author }}</h3>
          </div>

          <ng-template pTemplate="footer">
            <div class="book-actions">
              <p-button 
                icon="bi bi-star" 
                severity="warn"
                [outlined]="true"
                [rounded]="true"
                size="large"
                (onClick)="openRatingForm(book)"
                [title]="'Ohodnotit knihu'">
              </p-button>
              
              <p-button 
                icon="bi bi-info" 
                severity="success"
                [outlined]="true"
                [rounded]="true"
                size="large"
                [title]="'Přidat do oblíbených'">
              </p-button>
              
              <p-button 
                icon="bi bi-trash" 
                severity="danger"
                [outlined]="true"
                [rounded]="true"
                size="large"
                (onClick)="removeBook(book.bookid, $event)"
                [title]="'Smazat knihu'">
              </p-button>
            </div>
          </ng-template>

          <!-- Rating Form Overlay -->
          @if (showRatingForm && activeRatingBookId === book.bookid) {
            <div class="overlay">
              <div class="form-container">
                <div class="form-group">
                  <label>Hodnocení</label>
                  <p-rating 
                    [(ngModel)]="bookRating.value" 
                    [stars]="5">
                  </p-rating>
                </div>
                <div class="form-group checkbox-group">
                  <p-checkbox 
                    [binary]="true"
                    [(ngModel)]="bookLike.value"
                    [inputId]="'like-' + book.bookid">
                  </p-checkbox>
                  <label [for]="'like-' + book.bookid">Chci přidat knihu do oblíbených</label>
                </div>
                <div class="form-buttons">
                  <p-button 
                    label="Odeslat recenzi"
                    severity="success"
                    (onClick)="sendRating(book)">
                  </p-button>
                  <p-button 
                    label="Zavřít"
                    severity="secondary"
                    [outlined]="true"
                    (onClick)="showRatingForm = false; activeRatingBookId = null;">
                  </p-button>
                </div>
              </div>
            </div>
          }
        </p-card>
      }
    </div>
  } @else {
    <!-- Empty state -->
    <div class="empty-state">
      <i class="bi bi-book empty-icon"></i>
      <h2>Žádné knihy</h2>
      <p>Zatím nemáte žádné knihy ve svém seznamu.</p>
      <p-button 
        label="Přidat knihu" 
        icon="bi bi-plus"
        routerLink="/homepage">
      </p-button>
    </div>
  }
</div>